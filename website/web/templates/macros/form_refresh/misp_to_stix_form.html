{% macro misp_to_stix_form(form, uploaded_filename=None) %}
<form method="post" enctype="multipart/form-data">
    {{ form.hidden_tag() }}

    <!-- Version -->
    <div class="row mb-3">
        <div class="col-md-6">
            {{ form.version.label(class_="form-label") }}
            <span class="text-danger">*</span>
            {{ form.version(class_="form-select",
            style="background-color:var(--color-navbar); color:var(--color-text);") }}
            {% for err in form.version.errors %}
            <div class="invalid-feedback d-block">{{ err }}</div>
            {% endfor %}
        </div>
    </div>

    <!-- Fichier (visible + non modifiable) -->
    <div class="row mb-3">
        <div class="col-md-8">
            <label class="form-label">MISP File <span class="text-danger">*</span></label>

            {% if uploaded_filename %}
            <!-- Champ fichier désactivé -->
            <input type="text" class="form-control" value="{{ uploaded_filename }}" disabled
                style="background-color:var(--color-navbar); color:var(--color-text);">

            <!-- Champ caché pour conserver le nom -->
            <input type="hidden" name="existing_file" value="{{ uploaded_filename }}">
            {% else %}
            <!-- Champ normal si aucun fichier encore upload -->
            <input type="file" class="form-control" name="file" required
                style="background-color:var(--color-navbar); color:var(--color-text);">
            {% endif %}
        </div>
    </div>

    <button type="submit" name="convert" class="btn btn-primary">
        {{ form.convert.label }}
    </button>
</form>
{% endmacro %}